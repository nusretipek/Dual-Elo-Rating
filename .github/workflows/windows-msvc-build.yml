name: windows-msvc-build

on:
  push:
  pull_request:
  workflow_dispatch:

jobs:
  build-msvc:
    name: Build (MSVC)
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up MSVC build environment
        uses: microsoft/setup-msbuild@v1

      - name: Configure CMake
        run: cmake -S "Dual Elo" -B build/msvc -G "Visual Studio 17 2022" -A x64 -DCMAKE_BUILD_TYPE=Release

      - name: Build DualEloRating
        run: cmake --build build/msvc --config Release --target DualEloRating

      - name: Copy executable to build folder
        shell: pwsh
        run: |
          New-Item -ItemType Directory -Path build -Force | Out-Null
          Copy-Item -Path "build/msvc/Release/DualEloRating.exe" -Destination "build/DualEloRating.exe" -Force

      - name: Upload DualEloRating artifact
        uses: actions/upload-artifact@v4
        with:
          name: DualEloRating-windows-msvc
          path: build/DualEloRating.exe
          if-no-files-found: error
